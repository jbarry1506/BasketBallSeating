<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
        <title>areaBasketball</title>
        <link href='../areaMap/css/sct.css' rel='stylesheet' type='text/css'/>        
        <script src='../areaMap/js/jquery-1.11.1.min.js'></script>
        <script src='../areaMap/js/jquery.tablesorter.js'></script>        
        <script src="../areaMap/js/imagemapster.js"></script>
        <!-- <script src="../areaMap/js/kinetic-v5.0.2.js"></script> -->
        <script src="../areaMap/js/underscore.js"></script>
        <script src="../areaMap/js/arTickets.js"></script>
        <script src="../areaMap/js/arSection.js"></script>
        <script src="../areaMap/js/arGuests.js"></script>
        <script src='../areaMap/js/hoverIntent.js'></script>        
    </head>

    <body>
        <div id="cursor"></div>
        <div id='sidebar'>
            <table id='guestTable'>
                <thead>
                    <tr>
                        <th><span> Name </span></th>
                        <th><span> RSVP </span></th>
                        <th><span> Invited Via </span></th>
                        <th><span> Giving </span></th>
                        <th><span> 11 </span></th>
                        <th><span> 47 </span></th>
                        <th><span> 55 </span></th>
                    </tr>
                </thead>
                <tbody>
                    
                </tbody>
            </table>
        </div>
            <div class='canButton Floor' id="FloorButton">
                Floor
            </div>
            <div class='canButton Box16' id="B16Button">
                Box 16
            </div>
            <div class='canButton Box33' id="B33Button">
                Box 33
            </div>
            <div class='canButton Box38' id="B38Button">
                Box 38
            </div>
            <div class='canButton Box52' id="B52Button">
                Box 52
            </div>
            <div class='canButton Box53' id="B53Button">
                Box 53
            </div>
            <div class='canButton Box57' id="B57Button">
                Box 57
            </div>
            <div class='canButton Box58' id="B58Button">
                Box 58
            </div>
            <div class='canButton S11' id="S11Button">
                Suite 11
            </div>
            <div class='canButton S47' id="S47Button">
                Suite 47
            </div>
            <div class='canButton S52' id="S52Button">
                Suite 52
            </div>
            <div class='canButton S55' id="S55Button">
                Suite 55
            </div>
                                                                                                                                    
        <div class='outerCanvas'>
        
        </div>  
            <div class='can2' id='canvas'>
        <div>
            <img style="position:absolute;left:10px;top: 20px;border:0;" id="basketballMap" 
            src="../areaMap/resources/kfc-yum-center2-Steel.png" alt="" usemap="#basketballMap">
        </div>            
        <map name="basketballMap">
            <area href="#" section="floor" id="floor" class = 'clickme' shape="poly" coords="359, 524, 359, 371, 673, 369, 674, 525" />
            <area href="#" section="sec330" id="sec330" class = 'clickme' shape="poly" coords="19, 455, 74, 455, 73, 521, 18, 521, 19, 512, 48, 501, 47, 489, 39, 480, 22, 479" />
            <area href="#" section="sec329" id="sec329" class = 'clickme' shape="poly" coords="102, 606, 31, 646, 16, 621, 52, 584, 52, 577, 1, 575, 1, 534, 75, 536, 76, 567" />
            <area href="#" section="sec328" id="sec328" class = 'clickme' shape="poly" coords="111, 616, 157, 680, 75, 727, 36, 659" />
            <area href="#" section="sec327" id="sec327" class = 'clickme' shape="poly" coords="216, 680, 235, 691, 161, 817, 110, 788, 83, 737, 160, 692, 183, 714" />
            <area href="#" section="sec326" id="sec326" class = 'clickme' shape="poly" coords="245, 699, 311, 735, 312, 740, 244, 867, 175, 824" />
            <area href="#" section="sec325" id="sec325" class = 'clickme' shape="poly" coords="362, 754, 363, 899, 300, 898, 255, 872, 326, 741, 344, 753" />
            <area href="#" section="sec324" id="sec324" class = 'clickme' shape="poly" coords="469, 755, 469, 898, 376, 899, 377, 754" />
            <area href="#" section="sec323" id="sec323" class = 'clickme' shape="poly" coords="573, 752, 574, 899, 483, 899, 482, 751" />
            <area href="#" section="sec322" id="sec322" class = 'clickme' shape="poly" coords="678, 753, 679, 899, 585, 897, 587, 754" />
            <area href="#" section="sec321" id="sec321" class = 'clickme' shape="poly" coords="731, 744, 803, 865, 803, 872, 754, 899, 693, 897, 691, 753, 719, 753" />
            <area href="#" section="sec320" id="sec330" class = 'clickme' shape="poly" coords="741, 739, 811, 698, 879, 820, 878, 826, 820, 862, 811, 860" />
            <area href="#" section="sec319" id="sec319" class = 'clickme' shape="poly" coords="893, 689, 969, 734, 970, 743, 949, 788, 895, 819, 821, 689, 841, 681, 875, 715" />
            <area href="#" section="sec318" id="sec318" class = 'clickme' shape="poly" coords="938, 611, 1008, 654, 1010, 661, 977, 725, 897, 677" />
            <area href="#" section="sec317" id="sec317" class = 'clickme' shape="poly" coords="976, 535, 1055, 535, 1055, 577, 1007, 576, 1010, 587, 1036, 604, 1018, 643, 947, 603, 979, 550" />
            <area href="#" section="sec316" id="sec316" class = 'clickme' shape="poly" coords="945, 451, 1031, 451, 1030, 480, 1008, 491, 1008, 496, 1033, 512, 1032, 519, 978, 520, 977, 513, 944, 512" />
            <area href="#" section="sec315" id="sec315" class = 'clickme' shape="poly" coords="945, 381, 977, 382, 977, 369, 1035, 369, 1035, 386, 1010, 398, 1011, 407, 1032, 417, 1032, 438, 945, 437" />
            <area href="#" section="sec314" id="sec314" class = 'clickme' shape="poly" coords="946, 293, 1029, 243, 1054, 284, 1008, 308, 1008, 317, 1052, 318, 1053, 356, 976, 356, 976, 346" />
            <area href="#" section="sec313" id="sec313" class = 'clickme' shape="poly" coords="898, 217, 983, 165, 1023, 229, 1023, 236, 940, 284" />
            <area href="#" section="sec312" id="sec312" class = 'clickme' shape="poly" coords="819, 207, 892, 78, 946, 110, 975, 156, 896, 207, 872, 176, 836, 211, 827, 213" />
            <area href="#" section="sec311" id="sec311" class = 'clickme' shape="poly" coords="743, 162, 817, 34, 880, 71, 809, 200" />
            <area href="#" section="sec310" id="sec310" class = 'clickme' shape="poly" coords="692, 145, 694, 1, 755, 0, 804, 27, 732, 157, 716, 145" />
            <area href="#" section="sec309" id="sec309" class = 'clickme' shape="poly" coords="585, 144, 585, 0, 680, 0, 680, 145" />
            <area href="#" section="sec308" id="sec308" class = 'clickme' shape="poly" coords="480, 145, 480, 0, 571, 0, 572, 145" />
            <area href="#" section="sec307" id="sec307" class = 'clickme' shape="poly" coords="377, 143, 377, 2, 466, 0, 467, 146" />
            <area href="#" section="sec306" id="sec306" class = 'clickme' shape="poly" coords="325, 153, 255, 27, 296, 1, 365, 0, 366, 144, 341, 144" />
            <area href="#" section="sec305" id="sec305" class = 'clickme' shape="poly" coords="243, 196, 175, 73, 244, 31, 314, 153, 314, 159, 248, 198" />
            <area href="#" section="sec304" id="sec304" class = 'clickme' shape="poly" coords="159, 205, 82, 161, 109, 116, 167, 78, 232, 198, 232, 204, 221, 211, 214, 209, 181, 178" />
            <area href="#" section="sec303" id="sec303" class = 'clickme' shape="poly" coords="112, 275, 106, 276, 37, 240, 75, 173, 151, 214, 151, 219" />
            <area href="#" section="sec302" id="sec302" class = 'clickme' shape="poly" coords="76, 362, 0, 363, -1, 316, 49, 318, 49, 310, 17, 279, 32, 252, 106, 287, 77, 328" />
            <area href="#" section="sec301" id="sec301" class = 'clickme' shape="poly" coords="74, 439, 22, 440, 22, 416, 36, 416, 46, 411, 46, 402, 20, 387, 20, 377, 75, 377" />
            <area href="#" section="sec220" id="sec220" class = 'clickme' shape="poly" coords="86, 460, 166, 461, 166, 509, 98, 527, 86, 526" />
            <area href="#" section="sec219" id="sec219" class = 'clickme' shape="poly" coords="87, 541, 169, 522, 169, 544, 180, 558, 182, 562, 115, 599, 88, 561" />
            <area href="#" section="sec218" id="sec218" class = 'clickme' shape="poly" coords="123, 608, 189, 571, 214, 605, 213, 612, 154, 647, 147, 645" />
            <area href="#" section="sec217" id="sec217" class = 'clickme' shape="poly" coords="157, 655, 222, 617, 237, 637, 237, 646, 181, 694" />
            <area href="#" section="sec212" id="sec212" class = 'clickme' shape="poly" coords="854, 576, 920, 612, 921, 618, 877, 691, 870, 691, 816, 645" />
            <area href="#" section="sec211" id="sec211" class = 'clickme' shape="poly" coords="875, 450, 933, 450, 933, 528, 963, 528, 964, 549, 931, 608, 858, 566, 877, 534" />
            <area href="#" section="sec210" id="sec210" class = 'clickme' shape="poly" coords="857, 319, 925, 287, 962, 345, 962, 370, 934, 370, 933, 436, 877, 435, 879, 357" />
            <area href="#" section="sec209" id="sec209" class = 'clickme' shape="poly" coords="815, 245, 872, 199, 920, 273, 919, 277, 855, 308, 849, 307" />
            <area href="#" section="sec204" id="sec204" class = 'clickme' shape="poly" coords="225, 270, 217, 270, 155, 233, 184, 196, 238, 246, 238, 251" />
            <area href="#" section="sec203" id="sec203" class = 'clickme' shape="poly" coords="191, 317, 184, 316, 123, 281, 151, 244, 215, 280, 215, 285" />
            <area href="#" section="sec202" id="sec202" class = 'clickme' shape="poly" coords="170, 367, 161, 367, 87, 355, 88, 337, 118, 294, 183, 326, 183, 334, 170, 352" />
            <area href="#" section="sec201" id="sec201" class = 'clickme' shape="poly" coords="166, 438, 86, 439, 86, 367, 166, 381" />
            <area href="#" section="sec120" id="sec120" class = 'clickme' shape="poly" coords="328, 534, 224, 589, 215, 587, 183, 540, 184, 502, 325, 499, 329, 517" />
            <area href="#" section="sec119" id="sec119" class = 'clickme' shape="poly" coords="355, 562, 355, 569, 282, 698, 229, 668, 257, 645, 222, 597, 263, 575, 285, 605, 345, 554" />
            <area href="#" section="sec118" id="sec118" class = 'clickme' shape="poly" coords="391, 570, 392, 737, 347, 738, 292, 704, 371, 569" />
            <area href="#" section="sec117" id="sec117" class = 'clickme' shape="poly" coords="476, 538, 478, 736, 406, 735, 405, 536" />
            <area href="#" section="sec116" id="sec116" class = 'clickme' shape="poly" coords="563, 540, 563, 734, 490, 736, 489, 539" />
            <area href="#" section="sec115" id="sec115" class = 'clickme' shape="poly" coords="646, 539, 646, 735, 577, 735, 578, 540" />
            <area href="#" section="sec114" id="sec114" class = 'clickme' shape="poly" coords="674, 548, 763, 698, 763, 704, 713, 736, 659, 736, 658, 556" />
            <area href="#" section="sec113" id="sec113" class = 'clickme' shape="poly" coords="708, 529, 825, 594, 825, 602, 801, 649, 825, 668, 781, 697, 775, 696, 683, 544" />
            <area href="#" section="sec112" id="sec112" class = 'clickme' shape="poly" coords="718, 502, 863, 500, 862, 532, 837, 584, 830, 583, 709, 518" />
            <area href="#" section="sec111" id="sec111" class = 'clickme' shape="poly" coords="699, 408, 863, 408, 864, 488, 698, 488" />
            <area href="#" section="sec110" id="sec110" class = 'clickme' shape="poly" coords="706, 386, 838, 309, 863, 354, 862, 395, 713, 397" />
            <area href="#" section="sec109" id="sec109" class = 'clickme' shape="poly" coords="678, 353, 772, 198, 815, 226, 798, 241, 829, 294, 828, 300, 704, 377, 699, 364" />
            <area href="#" section="sec108" id="sec108" class = 'clickme' shape="poly" coords="659, 339, 662, 159, 713, 161, 758, 190, 759, 199, 672, 346, 666, 345" />
            <area href="#" section="sec107" id="sec107" class = 'clickme' shape="poly" coords="577, 352, 576, 159, 650, 160, 650, 353" />
            <area href="#" section="sec106" id="sec106" class = 'clickme' shape="poly" coords="487, 351, 489, 159, 567, 160, 566, 353" />
            <area href="#" section="sec105" id="sec105" class = 'clickme' shape="poly" coords="409, 353, 411, 160, 474, 160, 473, 355" />
            <area href="#" section="sec104" id="sec104" class = 'clickme' shape="poly" coords="373, 326, 294, 188, 343, 160, 397, 161, 397, 326" />
            <area href="#" section="sec103" id="sec103" class = 'clickme' shape="poly" coords="265, 319, 222, 295, 258, 246, 234, 226, 285, 200, 359, 330, 341, 340, 280, 292" />
            <area href="#" section="sec102" id="sec102" class = 'clickme' shape="poly" coords="321, 396, 182, 394, 183, 354, 217, 304, 328, 371" />
            <area href="#" section="sec101" id="sec101" class = 'clickme' shape="poly" coords="326, 488, 184, 486, 185, 405, 329, 408"  />
        </map>                
            </div>
               
        <div id='headingWindow'>
            <h1>KFC Yum! Center</h1>
            <h2></h2>
        </div>
        <div id='tempData'>
            <span id='tempDataName'></span>
            <span id='tempDataRSVP'></span>
            <span id='tempDataInvVia'></span>
            <span id='tempDataDon'></span>
        </div>
        <div id='sectionWindow'>
            <div class='sectionInfo'>
                <div class='infoInside'></div>
            </div>
            <div id='maindiv'></div>
        </div>
        <div>
            
        </div>        
        <script>

/***************************************************************************************
             Page load
***************************************************************************************/

    var globalSection = 0;
    var globalRows = 0;
    var globalSeats = 0;
    var globalAvailable = 0;
    var globalSecIndex = 0;
    var jso = JSONObject.seats;
    console.log("I got to this point");        
    var newRow = 0;    

var mapSet = {
    "mapset":
    [{
        "name": " ",
        "text": " ",
        "sectionNumber": " ",
        "ulSeats": " ",
        "available": " ",
        "percentAvailable": " ",
        "mapColor": " "
    }]
};

function newColor(section){
    for (var ms = 0; ms < mapSet.mapset.length; ms++){
        var thisSection = mapSet.mapset[ms].sectionNumber;
        
        if(section==thisSection){
            mapSet.mapset[ms].available = available(thisSection);
            var newPercent = mapSet.mapset[ms].available/mapSet.mapset[ms].ulSeats;
            mapSet.mapset[ms].mapColor = colorit(newPercent);
            var trueColor = mapSet.mapset[ms].mapColor;
            changeColor(thisSection,trueColor);   
        }
    }     
}

function available(sectionNumber){
    var numberAvailable = 0;
    for (var avSec = 0; avSec < jso.length; avSec++){
        var sectionKey = 'sec'+jso[avSec].section;
        if(sectionKey == sectionNumber){
            if(jso[avSec].claimed == '&nbsp'){
                numberAvailable++;
            }
        }        
    } 
    return numberAvailable;       
}

function colorit(av) {
    var maps = '';
    switch (av) {
        case 1:
            maps = '../areaMap/resources/kfc-yum-center2-Green.png';
            break;
        case 0:
            maps = '../areaMap/resources/kfc-yum-center2-Red.png';
            break;
        default:
            maps = '../areaMap/resources/kfc-yum-center2-light.png';
            break;
    }
    return maps;
}

function changeColor(section,color){
    var thisArea = $('area'+'[section='+section+']');
    thisArea.mapster('set', false)
        .mapster('set',true,{ altImage: color });
}
var allAreas = document.getElementsByTagName('area'); 
//console.log(allAreas);
      
function mapColors(){
    for (var ms = 0; ms < mapSet.mapset.length; ms++){  //ok
        //console.log('for loop works'); 
        var thisSection = mapSet.mapset[ms].sectionNumber;
       //console.log(thisSection);
        for(var areaIndex = 0; areaIndex < allAreas.length; areaIndex++){
            //console.log(allAreas[areaIndex].getAttribute('section'));
            var thisSection = mapSet.mapset[ms].sectionNumber;
            if(allAreas[areaIndex].getAttribute('section')==thisSection){
                //console.log($(this).attr('section'));
            mapSet.mapset[ms].available = available(thisSection);
            var newPercent = mapSet.mapset[ms].available/mapSet.mapset[ms].ulSeats;
            mapSet.mapset[ms].mapColor = colorit(newPercent);
            //console.log(mapSet.mapset[ms].mapColor);
            var trueColor = mapSet.mapset[ms].mapColor;
            changeColor(thisSection,trueColor);             
            }
        };
    }  
}

function resize() {
    var image = $('img');
    
    if($('#canvas').attr('class') == 'can2'){
        var maxWidth = 350;
        var maxHeight = 300;
        var resizeTime = 0;        
    } else {
        var maxWidth = 1056;
        var maxHeight = 900;
        var resizeTime = 0;
    }

    image.mapster('resize',maxWidth,maxHeight,resizeTime);   
}

function sectionIndex(thisSection){
    for(var i = 0; i < arSection.length; i++){
        if(thisSection == arSection[i][0]){
            return i;
            break;
        }
    }    
}

var default_options = {
        singleSelect: false,
        render_highlight: {
            fillColor: '5b6f7b',
            fill: true
        },
        isSelectable:false,
        mapKey: 'section',
        onClick: function (e) {
            resize(),
            $('#canvas').toggleClass('can can2');

            for (var ms = 0; ms < mapSet.mapset.length; ms++){
                if(e.key == mapSet.mapset[ms].sectionNumber && $('#canvas').attr('class') == 'can'){
                    var myName = mapSet.mapset[ms].name;
                    var mySection = mapSet.mapset[ms].text;
                    populate(myName, mySection);
                    if(globalSection == 0){
                    globalSection = arSection[myName][0];
                    globalRows = arSection[myName][3].length;
                    globalSeats = arSection[myName][1];
                    globalAvailable = available(e.key);
                    globalSecIndex = myName;                        
                    }
                $('h2').html('Section: ' + globalSection + '<br\>Rows: ' + globalRows + '<br\>Seats: ' + globalSeats + '<br\>Available: ' + globalAvailable);                    
                    break;
                }        
            }           
        },
        onMouseover: function (e) {
            for (var ms = 0; ms < mapSet.mapset.length; ms++){
                if(e.key == mapSet.mapset[ms].sectionNumber){                  
                    var myName = mapSet.mapset[ms].name;
                    globalAvailable = available(e.key);
                    globalSection = arSection[myName][0];
                    globalRows = arSection[myName][3].length;
                    globalSeats = arSection[myName][1];
                    $('.infoInside').html('Section: ' + globalSection + '<br\>Rows: ' + globalRows + '<br\>Seats: ' + globalSeats + '<br\>Available: ' + globalAvailable);
                    $('.sectionInfo').css('visibility', 'visible');
                    $('.infoInside').css('visibility', 'visible');
                    break;
                }        
            }
        },
        onMouseout: function (e) {
                $('.sectionInfo').css('visibility', 'hidden');
                $('.infoInside').css('visibility', 'hidden');
        },        
   };

function populate(id, section, mySeatId) {
    $('.section').remove();
    var sectionId = id;
    var sectionNumber = section;
    console.log('sectionId ' + sectionId);
    console.log('sectionNumber ' + sectionNumber);

    //Loop through the rows that we have seats for in this section. i should be < number of rows we have seats for
    for (var i = 0; i < arSection[sectionId][3].length; i++) {
        //console.log(arSection[sectionId][3]);
        var rowCreate = document.createElement('div');
        var rowID = arSection[sectionId][3][i][0];
        //jso[arCounter].row;   //row is undefined in this scope, pass in value
        var z = document.createTextNode(rowID);
        rowCreate.appendChild(z);
        rowCreate.id = rowID;
        rowCreate.className = 'section';
        var y = document.getElementById('maindiv');
        y.appendChild(rowCreate);
        document.getElementById(rowID).innerHTML += '<br>';
        var arCounter = 0;
        //Loop through all seats in the row. If the current seat object (jso[arCounter].seat)
        //does not match the current seat in the for loop, an unavailable seat is created.
        var numberOfSeats = arSection[sectionId][3][i][2];
        if ((arSection[sectionId][3][i][1][arCounter] > 100) && (numberOfSeats < 100)) {
            numberOfSeats += 100;
        }
        for (var j = 0; j < numberOfSeats; j++) {
            if ((arSection[sectionId][3][i][1][arCounter] > 100) && (j < 100)) {
                j += 100;
            }// end if((arSection[sectionId][3][i][1][arCounter] > 100) && (j < 100))
                //console.log(arSection[sectionId][3][i][1][arCounter]);
                //console.log(j+1);
            if (arSection[sectionId][3][i][1][arCounter] == (j + 1)) {

                var seatCreate = document.createElement('button');
                var seatNumber = document.createTextNode(j + 1);
                var seatRow = jso[arCounter].row;
                var seatClaimed = jso[arCounter].seat;
                for (var k = 0; k < jso.length; k++) {
                    if (jso[k].section == sectionNumber) {
                        if (jso[k].row == rowID) {
                            if (jso[k].seat == j + 1) {
                                if (jso[k].claimed != '&nbsp') {
                                    $(seatCreate).addClass('taken');
                                } else {
                                    $(seatCreate).addClass('available');
                                }
                                seatCreate.appendChild(seatNumber);
                                seatCreate.innerHTML += '<br><span style="font-size:8">' + jso[k].claimed + '</span>';
                                seatCreate.id = jso[k].section + 'Row' + jso[k].row + 'Seat' + jso[k].seat;
                                if(seatCreate.id == mySeatId)
                                {
                                    $(seatCreate).addClass('test');
                                }
                                var x = document.getElementById(rowID);
                                x.appendChild(seatCreate);
                                arCounter++;
                            }
                        }
                    }
                }
            } else {
                var uSeatCreate = document.createElement('button');
                var uSeatNumber = document.createTextNode(j + 1);

                $(uSeatCreate).addClass('notAvailable');
                uSeatCreate.appendChild(uSeatNumber);
                uSeatCreate.innerHTML += '<br><span style="font-size:6">Not</br>Available</span>';
                uSeatCreate.id = 'Section' + sectionId + 'Row' + rowID + 'Seat' + (j + 1);
                var ux = document.getElementById(rowID);
                ux.appendChild(uSeatCreate);
            }
        }
    }
/*********************************************************************************************************************
                                        functions to handle seat button rollover 
*********************************************************************************************************************/
        
    $('button').mouseover(function highlight() {
        if ($(this).hasClass('available') || $(this).hasClass('highlight')) {
            $(this).addClass('highlight');
        } else if ($(this).hasClass('notAvailable')) {
        }
    });
    $('button').mouseout(function unhighlight() {
        if ($(this).hasClass('available') || $(this).hasClass('highlight')) {
            $(this).addClass('available');
            $(this).removeClass('highlight');
        }
        if ($(this).hasClass('taken') || $(this).hasClass('highlightGray')) {
            $(this).addClass('taken');
            $(this).removeClass('highlightGray');
        }
    });
    $('button').mouseover(function highlightGray() {
        if ($(this).hasClass('taken') || $(this).hasClass('highlightGray')) {
            $(this).addClass('highlightGray');
        }
    });

    $('button').click(function buttonClicked() {
        var thisNumber = 'sec'+sectionNumber;

        //console.log(sectionNumber);
        for (var thisTicket = 0; thisTicket < arTickets.length; thisTicket++) {
            if (this.id == jso[thisTicket].seatID) {
                if ($(this).hasClass('taken')|| $(this).hasClass('highlightGray')) 
                {   //If this seat is taken or has been selected but nobody placed in it yet
                    if (tempData == true && jso[thisTicket].claimed == '&nbsp') 
                    {   //If a person is selected and this seat is selected but nobody placed in it yet
                        this.setAttribute('class', 'available');    //Toggle it back to available
                    } 
                    else if (removeMe == 'remove') 
                    {   //If removeMe is selected
                        if (jso[thisTicket].seasonTix.toLowerCase() === 'yes')
                        {   //Check if the seat is a season ticket holder
                            alert("I'm sorry, but that patron is a season ticket holder and can't be removed from the seat.");
                            break;
                        }
                        else 
                        {   //If removeMe is selected and this is not a season ticket seat
                            for(var thisGuest = 0; thisGuest < guestObject.guests.length; thisGuest++)
                            {   //Loop through the guest list to match a guest object with the person in this seat
                                if (jso[thisTicket].evipid == guestObject.guests[thisGuest].guestId)
                                {   //decrement guestsPlaced and update the tempData area with the info of the person that is being removed
                                    guestObject.guests[thisGuest].guestsPlaced -= 1;                                   
                                    $('#tempDataName').html('Name:&nbsp&nbsp&nbsp&nbsp' + guestObject.guests[thisGuest].fName + ' ' + guestObject.guests[thisGuest].lName);
                                    $('#tempDataRSVP').html('RSVP:&nbsp&nbsp&nbsp&nbsp' + guestObject.guests[thisGuest].rsvp);
                                    $('#tempDataInvVia').html('Invited Via:&nbsp&nbsp&nbsp&nbsp' + guestObject.guests[thisGuest].invVia);
                                    $('#tempDataDon').html('Placed:&nbsp&nbsp&nbsp&nbsp' + guestObject.guests[thisGuest].guestsPlaced);  //changed to guests placed for testing  
                                    rowColor(guestObject.guests[thisGuest].rsvp,guestObject.guests[thisGuest].guestsPlaced,guestObject.guests[thisGuest].guestId);

                                }
                             }
                            $(this).html(jso[thisTicket].seat + '</br><span style="font-size:8">' + '&nbsp' + '</span>');
//var url =  "FMP://136.165.242.26/President's Office Events.fmp12?script=JSPassDataToDB&$claimed=remove&$etid=" + jso[thisTicket].etid;
//window.location = url;
                            //Update the seats available
                            globalAvailable += 1;
                                   arSection[globalSecIndex][2] = globalAvailable;
                                                        
                            $('h2').html('Section: ' + globalSection + '<br\>Rows: ' + globalRows + '<br\>Seats: ' + globalSeats + '<br\>Available: ' + globalAvailable);
                            //Update the ticket object to remove claimed and evipid
                            jso[thisTicket].claimed = '&nbsp';
                            jso[thisTicket].evipid = '';
                            this.setAttribute('class', 'highlight');
                            mapSet.mapset[globalSecIndex].available+=1;
                            newColor(thisNumber); 
                        }
                    }
                }
                else if ($(this).hasClass('available') || $(this).hasClass('highlight')) {
                    if (tempData == false) {
                        alert('I\'m sorry, but you have not selected a patron to place in this seat.  Please select a patron from the table to the left.');
                    }
                    else 
                    {
                        $(this).html(jso[thisTicket].seat + '</br><span style="font-size:8">' + jso[thisTicket].claimed + '</span>');
                        this.setAttribute('class', 'highlightGray');
                    }
                }
                break;
            }
        }
    });
};
$('#basketballMap').mapster(default_options);

for (var secCount = 0; secCount < stadiumArray.length; secCount++){
    var avail = available('sec'+stadiumArray[secCount][0]);
    //console.log(avail);
    var percav = (avail/stadiumArray[secCount][1]);
    var mapObj = {
            "name": sectionIndex(stadiumArray[secCount][0]),
            "text": stadiumArray[secCount][0],
            "sectionNumber": "sec" + stadiumArray[secCount][0],
            "ulSeats": stadiumArray[secCount][1],
            "available": available('sec'+stadiumArray[secCount][0]),
            "percentAvailable": percav,
            "mapColor": colorit(percav)
    };    
    mapSet.mapset.push(mapObj);
}
mapSet.mapset.shift(); 
  


//    var layer = new Kinetic.Layer();

    // var findAvailable = function(secNum){
        // //seatsAvailable[sectionNumber][# of seats available]
        // //Loops through seatsAvailable array (created in arTickets js file) and returns number of seats available for the section passed in
        // for (var i = 0; i < seatsAvailable.length; i++) {
            // if(secNum == seatsAvailable[i][0]){
                // return seatsAvailable[i][1];
            // }
        // }
    // };
    function findGuest(guestID){
    try{
        var seatsForThisGuest = [];
        for (var i = 0; i < JSONObject.seats.length; i++) {
            if(guestID == JSONObject.seats[i].evipid){
                //alert(JSONObject.seats[i].section + ' ' + JSONObject.seats[i].row + ' ' + JSONObject.seats[i].seat);
                seatsForThisGuest.push(JSONObject.seats[i].section + ' ' + JSONObject.seats[i].row + ' ' + JSONObject.seats[i].seat);
            }
        }
        return seatsForThisGuest;
    }
    catch(err){}
    };
    function findSectionIndex(secNum){
        //Find the index needed to change to a new section when a section number is passed in
    try{
        for (var i = 0; i < arSection.length; i++) {
            if(secNum == arSection[i][0]){
                //If section number passed in == section number from arSection array
                return i;
            }
        }
    }
    catch(err){}
    };

    function rowColor(rsvp, placed, id) {
        if (placed < rsvp) {
            //console.log('less than \n' + id);
            $('tr#id' + id).css('color', '#ffffff');  //'tr#id' + guestId
        } else if (placed == rsvp) {
            //console.log('equal to \n' + id);
            $('tr#id' + id).css('color', 'rgb(50,255,50)');
        } else {
            //console.log('greater than \n' + id);
            $('tr#id' + id).css('color', 'rgb(227,27,35)');
        }            
    };
            //create new table row for all arSeats
            for (var i = 0; i < arRecords.length-1; i++) {
                var guestId = guestObject.guests[i].guestId;
                $('#guestTable').append('<tr id=\"id' + guestId + '\"></tr>');
                $('tr#id'+ guestId).append('<td>' + guestObject.guests[i].lName + ', ' + guestObject.guests[i].fName + '</tr>');
                $('tr#id'+ guestId).append('<td>' + guestObject.guests[i].rsvp + '</td>');
                $('tr#id'+ guestId).append('<td>' + guestObject.guests[i].invVia + '</td>');
                $('tr#id'+ guestId).append('<td>' + guestObject.guests[i].donation + '</td>');
                $('tr#id' + guestId).append('<td>' + guestObject.guests[i].suite11 + '</td></tr>');
                $('tr#id' + guestId).append('<td>' + guestObject.guests[i].suite47 + '</td></tr>');
                $('tr#id' + guestId).append('<td>' + guestObject.guests[i].suite55 + '</td></tr>');
                rowColor( parseInt(guestObject.guests[i].rsvp), parseInt(guestObject.guests[i].guestsPlaced), guestId );
            }
            
            var tempData = false;
            //array to hold temporary values when a guest name is clicked
            var arTemp = {
                "objTemp":[{
                    "Name" : null,
                    "RSVP" : null,
                    "InvVia" : null,
                    "Donation" : null,
                    "guestId" : null
                }]
            };

        $('html').append('<h4 class="dummyButton" id="remove">Remove</h4>');
        $('html').append('<h4 class="dummyButton" id="place">Place</h4>');
        
        var seatNumber = '';
        var person = '';
        var removeMe = '';
        var placePerson = '';

        //Click function for the remove object
        $('h4#remove').click(function() {
            removeMe = 'remove';
            tempData = false;
            $('#tempDataName').html('Name:&nbsp&nbsp&nbsp&nbsp');
            $('#tempDataRSVP').html('RSVP:&nbsp&nbsp&nbsp&nbsp');
            $('#tempDataInvVia').html('Invited Via:&nbsp&nbsp&nbsp&nbsp');
            $('#tempDataDon').html('Placed:&nbsp&nbsp&nbsp&nbsp');
            
            $('#tempDataName').css('background', 'rgb(138,37,41)');
            $('#tempDataRSVP').css('background', 'rgb(138,37,41)');
            $('#tempDataInvVia').css('background', 'rgb(138,37,41)');
            $('#tempDataDon').css('background', 'rgb(138,37,41)');
        });

        //Click function to place patrons in seats
        $('h4#place').click(function() {
            removeMe = '';
            var grayArray = []; 
            var graySeats = document.getElementsByClassName('taken'), grayCounter = graySeats.length;
            while (grayCounter--) {
                for (var grayIterator = 0; grayIterator < JSONObject.seats.length; grayIterator++) {
                    if (graySeats[grayCounter].id == JSONObject.seats[grayIterator].seatID) {
                        if (JSONObject.seats[grayIterator].claimed == '&nbsp') {
                            JSONObject.seats[grayIterator].claimed = arTemp.objTemp.Name;
                            JSONObject.seats[grayIterator].evipid = arTemp.objTemp.guestId;     //8/8/14 Ryan changed evipid = ' ' to evipid = arTemp.objTemp.guestId
                            grayArray.push(JSONObject.seats[grayIterator].etid); //grayArray.push([JSONObject.seats[grayIterator].etid, JSONObject.seats[grayIterator].evipid]);
                            //console.log(grayArray);
                            $('#' + graySeats[grayCounter].id).html(JSONObject.seats[grayIterator].seat + '</br><span style="font-size:8">' + JSONObject.seats[grayIterator].claimed + '</span>');
                            
                        }
                    }
                }
            }
//var url =  "FMP://136.165.242.26/President's Office Events.fmp12?script=JSPassDataToDB&$claimed=" + arTemp.objTemp.Name + "&$etid=" + grayArray + "&$evipid=" + arTemp.objTemp.guestId;
//window.location = url;
            globalAvailable -= grayArray.length;
            arSection[globalSecIndex][2] = globalAvailable;
            //mapSet.mapset[globalSecIndex].available -= grayArray.length;
            $('h2').html('Section: ' + globalSection + '<br\>Rows: ' + globalRows + '<br\>Seats: ' + globalSeats + '<br\>Available: ' + globalAvailable);
            guestObject.guests[arTemp.objTemp.guestIndex].guestsPlaced = parseInt(guestObject.guests[arTemp.objTemp.guestIndex].guestsPlaced) + parseInt(grayArray.length);
            $('#tempDataDon').html('Placed:&nbsp&nbsp&nbsp&nbsp' + guestObject.guests[arTemp.objTemp.guestIndex].guestsPlaced);
            rowColor(parseInt(guestObject.guests[arTemp.objTemp.guestIndex].rsvp),parseInt(guestObject.guests[arTemp.objTemp.guestIndex].guestsPlaced), arTemp.objTemp.guestId);
            var mySection = 'sec'+globalSection;
            newColor(mySection);
        });

       $('tr').on('click', function() {
            for (var i = 0; i < guestObject.guests.length; i++) {
                if (this.getAttribute('id') == ('id' + guestObject.guests[i].guestId)) {
                    arTemp.objTemp.Name = guestObject.guests[i].lName + ', ' + guestObject.guests[i].fName;
                    arTemp.objTemp.RSVP = guestObject.guests[i].rsvp;
                    arTemp.objTemp.InvVia = guestObject.guests[i].invVia;
                    arTemp.objTemp.Donation = guestObject.guests[i].donation;
                    arTemp.objTemp.guestId = guestObject.guests[i].guestId; 
                    arTemp.objTemp.guestsPlaced = guestObject.guests[i].guestsPlaced;                     
                    //alert(arTemp.objTemp.guestId);
                    arTemp.objTemp.guestIndex = i;
                    $('#tempDataName').html('Name:&nbsp&nbsp&nbsp&nbsp' + arTemp.objTemp.Name);
                    $('#tempDataRSVP').html('RSVP:&nbsp&nbsp&nbsp&nbsp' + arTemp.objTemp.RSVP);
                    $('#tempDataInvVia').html('Invited Via:&nbsp&nbsp&nbsp&nbsp' + arTemp.objTemp.InvVia);
                    $('#tempDataDon').html('Placed:&nbsp&nbsp&nbsp&nbsp' + arTemp.objTemp.guestsPlaced);
                    // $('h2').html('Section: ' + arSection[myName][0] + '<br\>Rows: ' + arSection[myName][3].length + '<br\>Seats: ' + arSection[myName][1] + '<br\>Available: ' + arSection[myName][2]);
                    $('#tempDataName').css('background', 'none');
                    $('#tempDataRSVP').css('background', 'none');
                    $('#tempDataInvVia').css('background', 'none');
                    $('#tempDataDon').css('background', 'none');

                    break;
                findGuest(guestObject.guests[i].guestId);
                }
            }
            tempData = true;
            removeMe = '';
       });
       
$("tr").hoverIntent({
    sensitivity: 1, // number = sensitivity threshold (must be 1 or higher)    
    interval: 400,  // number = milliseconds for onMouseOver polling interval    
    timeout: 700,   // number = milliseconds delay before onMouseOut    
    over: function over(){
        var seatedIn = findGuest(this.getAttribute('id').substr(2)).toString();
        if(seatedIn == "")
        {
            return;
        }
        var hoverId = this.getAttribute('id').substr(2);
        seatedIn = seatedIn.replace(/,/g,"<br>");
        var secRowSeat = seatedIn.split("<br>");
        $('div#headingWindow').append("<div class='guestInfo'><div class='guestinfoInside'>");
        secRowSeat.forEach(function(value)
        {
            var sectionNum = value.split(" ");
            $('div#headingWindow').find(".guestinfoInside").append("<span class='spanHover' onClick=\"goToSection('"+value+"')\">" + value + "</span>");
        });
        $('div#headingWindow').append("</div></div>");
        $("div.guestInfo").hoverIntent({
            sensitivity: 1, // number = sensitivity threshold (must be 1 or higher)    
            interval: 100,  // number = milliseconds for onMouseOver polling interval    
            timeout: 700,   // number = milliseconds delay before onMouseOut    
            over:function(){
                $('div.guestInfo').removeClass('guestInfoHovered');
                $('div#headingWindow').find(".guestInfo").remove();
                $('tr#id' + hoverId).removeClass('trHover');                
                $('div.guestInfo').addClass('guestInfoHovered');
            },
            out: function(){
                $('div.guestInfo').removeClass('guestInfoHovered');
                $('div#headingWindow').find(".guestInfo").remove();
                $('tr#id' + hoverId).removeClass('trHover');
            }
            });
    },
    out: function out(){
        if($('div#headingWindow').find(".guestInfo").hasClass("guestInfoHovered")){
            //do nothing if the mouse has moved over the guest info div
            $('tr#' + this.getAttribute('id')).addClass('trHover');
        }
        else{
            //otherwise remove the guest info div
        $('div#headingWindow').find(".guestInfo").remove();
        //$('div#headingWindow').find(".guestInfo").css('visibility', 'hidden');
        }
    }
});
        $(function() {
            $('#guestTable').tablesorter();
        });

function buttonAvailable(index){
   
    var numberAvailable = 0;
    for (var avSec = 0; avSec < jso.length; avSec++){
        var sectionIndex = jso[avSec].section;
        if(sectionIndex == arSection[index][0]){
            if(jso[avSec].claimed == '&nbsp'){
                numberAvailable++;
            }
        }        
    }    
    return numberAvailable;     
}

function setH2(index){
    $('h2').empty();     
    globalSection = arSection[index][0];
    globalRows = arSection[index][3].length;
    globalSeats = arSection[index][1]; 
    globalAvailable = buttonAvailable(index);
    $('h2').html('Section: ' + globalSection + '<br\>Rows: ' + globalRows + '<br\>Seats: ' + globalSeats + '<br\>Available: ' + globalAvailable);       
}
// function available(sectionNumber){
    // var numberAvailable = 0;
    // for (var avSec = 0; avSec < jso.length; avSec++){
        // var sectionKey = 'sec'+jso[avSec].section;
        // if(sectionKey == sectionNumber){
            // if(jso[avSec].claimed == '&nbsp'){
                // numberAvailable++;
            // }
        // }        
    // } 
    // return numberAvailable;       
// }

$('.canButton').click(function(){
    switch(this.id){
        case "FloorButton":
            var testId = findSectionIndex('Floor');
            var testSec = 'FLR';
            setH2(testId);                        
            populate(testId, testSec);
            break; 
        case "B16Button":
            var testSec = 'B16';
            var testId = findSectionIndex('B16');
            setH2(testId);                        
            populate(testId, testSec);
            break; 
        case "B33Button":
            var testSec = 'B33';
            var testId = findSectionIndex('B33');
            setH2(testId);
            populate(testId, testSec);
            break; 
        case "B38Button":
            var testSec = 'B38';
            var testId = findSectionIndex('B38');
            setH2(testId);
            populate(testId, testSec);
            break; 
        case "B52Button":
            var testSec = 'B52';
            var testId = findSectionIndex('B52');
            setH2(testId);
            populate(testId, testSec);
            break;
        case "B53Button":
            var testSec = 'B53';
            var testId = findSectionIndex('B53');
            setH2(testId);
            populate(testId, testSec);
            break; 
        case "B57Button":
            var testSec = 'B57';
            var testId = findSectionIndex('B57');
            setH2(testId);
            populate(testId, testSec);
            break; 
        case "B58Button":
            var testSec = 'B58';
            var testId = findSectionIndex('B58');
            setH2(testId);
            populate(testId, testSec);
            break; 
        case "S11Button":
            var testSec = 'S11';
            var testId = findSectionIndex('S11');
            setH2(testId);
            populate(testId, testSec);
            break; 
        case "S47Button":
            var testSec = 'S47';
            var testId = findSectionIndex('S47');
            setH2(testId);
            populate(testId, testSec);
            break; 
        case "S52Button":
            var testSec = 'S52';
            var testId = findSectionIndex('S52');
            setH2(testId);
            populate(testId, testSec);
            break;
        case "S55Button":
            var testSec = 'S55';
            var testId = findSectionIndex('S55');
            setH2(testId);
            populate(testId, testSec);
            break; 
        default:
            console.log('didn\'t work');           
        
    }

}); 

$(window).load(function() {
mapColors();
});    
// function goToSection(sectionNum){
    // var section = sectionNum.split(' ');
    // var mySection = section[0];
    // var myRow = section[1];
    // var mySeat = section[2];
    // var mySeatId = mySection + 'Row' + myRow + 'Seat' + mySeat;
    // var myName = findSectionIndex(mySection);
//     
    // globalSection = arSection[myName][0];
    // globalRows = arSection[myName][3].length;
    // globalSeats = arSection[myName][1];
    // globalAvailable = mapSet.mapset[ms].available;
    // globalSecIndex = myName;
// 
    // $('h2').html('Section: ' + arSection[myName][0] + '<br\>Rows: ' + arSection[myName][3].length + '<br\>Seats: ' + arSection[myName][1] + '<br\>Available: ' + mapSet.mapset[ms].available);
// 
    // $('div#maindiv').css('background-image', arSection[myName][4]);
    // $('div#maindiv').css('background-repeat', 'no-repeat');
    // $('div#maindiv').css('background-position', 'center');
    // $('div#maindiv').css('background-size', 'contain');
    // populate(myName, mySection, mySeatId);
    // }
        </script>
        

    </body>
</html>